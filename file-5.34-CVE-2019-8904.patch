From 63ad083083a467a297e32acb701d0515b130967e Mon Sep 17 00:00:00 2001
From: Christos Zoulas <christos@zoulas.com>
Date: Thu, 2 Aug 2018 12:46:02 +0000
Subject: [PATCH 1/3] correct error handling for file_printf() (coverity)

Upstream-commit: 813f1b8a37bc1384b33d6598ec5bad0c8e754caf
Signed-off-by: Kamil Dudka <kdudka@redhat.com>
---
 src/readelf.c | 12 +++++++-----
 1 file changed, 7 insertions(+), 5 deletions(-)

diff --git a/src/readelf.c b/src/readelf.c
index db312b5..2c1b450 100644
--- a/src/readelf.c
+++ b/src/readelf.c
@@ -563,7 +563,7 @@ do_bid_note(struct magic_set *ms, unsigned char *nbuf, uint32_t type,
 	    type == NT_GO_BUILD_ID && descsz < 128) {
 		if (file_printf(ms, ", Go BuildID=%s",
 		    (char *)&nbuf[doff]) == -1)
-			return 1;
+			return -1;
 		return 1;
 	}
 	return 0;
@@ -1113,14 +1113,16 @@ donote(struct magic_set *ms, void *vbuf, size_t offset, size_t size,
 	}
 
 	if (namesz & 0x80000000) {
-	    file_printf(ms, ", bad note name size %#lx",
-		CAST(unsigned long, namesz));
+		if (((file_printf(ms, ", bad note name size %#lx",
+		    CAST(unsigned long, namesz)) == -1)
+			return -1;
 	    return 0;
 	}
 
 	if (descsz & 0x80000000) {
-	    file_printf(ms, ", bad note description size %#lx",
-		CAST(unsigned long, descsz));
+		if (file_printf(ms, ", bad note description size %#lx",
+		    CAST(unsigned long, descsz)) == -1)
+		    	return -1;
 	    return 0;
 	}
 
-- 
2.17.2


From ac9cb251746b04c0e2dd529af4903d9512c01220 Mon Sep 17 00:00:00 2001
From: Christos Zoulas <christos@zoulas.com>
Date: Fri, 3 Aug 2018 09:00:13 +0000
Subject: [PATCH 2/3] remove extra parens

Upstream-commit: b9e60f088847f885b5c9fde61ff8fc9645843506
Signed-off-by: Kamil Dudka <kdudka@redhat.com>
---
 src/readelf.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/src/readelf.c b/src/readelf.c
index 2c1b450..fa08845 100644
--- a/src/readelf.c
+++ b/src/readelf.c
@@ -1113,7 +1113,7 @@ donote(struct magic_set *ms, void *vbuf, size_t offset, size_t size,
 	}
 
 	if (namesz & 0x80000000) {
-		if (((file_printf(ms, ", bad note name size %#lx",
+		if (file_printf(ms, ", bad note name size %#lx",
 		    CAST(unsigned long, namesz)) == -1)
 			return -1;
 	    return 0;
-- 
2.17.2


From cd96a664d539cae2d9d42d8f6441875b245a034a Mon Sep 17 00:00:00 2001
From: Christos Zoulas <christos@zoulas.com>
Date: Mon, 18 Feb 2019 17:30:41 +0000
Subject: [PATCH 3/3] PR/62: spinpx: Avoid non-nul-terminated string read.

Upstream-commit: 94b7501f48e134e77716e7ebefc73d6bbe72ba55
Signed-off-by: Kamil Dudka <kdudka@redhat.com>
---
 src/readelf.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/src/readelf.c b/src/readelf.c
index fa08845..e3841cf 100644
--- a/src/readelf.c
+++ b/src/readelf.c
@@ -561,8 +561,8 @@ do_bid_note(struct magic_set *ms, unsigned char *nbuf, uint32_t type,
 	}
 	if (namesz == 4 && strcmp((char *)&nbuf[noff], "Go") == 0 &&
 	    type == NT_GO_BUILD_ID && descsz < 128) {
-		if (file_printf(ms, ", Go BuildID=%s",
-		    (char *)&nbuf[doff]) == -1)
+		if (file_printf(ms, ", Go BuildID=%.*s",
+		    CAST(int, descsz), CAST(char *, &nbuf[doff])) == -1)
 			return -1;
 		return 1;
 	}
-- 
2.17.2

